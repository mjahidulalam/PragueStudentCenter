<!-- Things To do:
> Render images and files at the same time!!  
-->

{% extends 'root.html' %}
{% load crispy_forms_tags %}
{% load hitcount_tags %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css" integrity="sha256-46r060N2LrChLLb5zowXQ72/iKKNiw/lAmygmHExk/o=" crossorigin="anonymous" />

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

<div class="container" style="height: calc(100vh - 80px)">
    <div class="main-body p-0">
        <div class="inner-wrapper">
            <!-- Inner sidebar -->
            {% include 'components/sidebar.html' %}            
            <!-- /Inner sidebar -->

            <!-- Inner main -->
            <div class="inner-main">
                <!-- Inner main header -->
                <div class="inner-main-header bg-dark" style='border-color: gray;'>
                    <div class="navigation">
                        <span class="text-light"><a href="{% url 'forum:home' %}">Subjects</a> / <a href="{{post.categories.get_url}}">{{post.categories}}</a> / <a href="{{post.get_url}}">{{post.title}}</a></span>
                    </div>
                    <span class="input-icon input-icon-sm ml-auto w-auto">
                        <input type="text" class="form-control form-control-sm mb-4 mt-4 bg-dark" style='border-color: gray;' placeholder="Search forum" />
                    </span>
                </div>
                <!-- /Inner main header -->

                <!-- Inner main body -->

                <!-- Forum Detail -->
                <div class="inner-main-body p-2 p-sm-3 collapse forum-content show">

                    <!-- <div class="col-auto" style="padding-bottom: 10px; padding-right: 0px;"> -->
                        {% if user.id == post.user.id %}
                        <div class="d-flex justify-content-end" style="padding-bottom: 10px;">
                          <div class="col-auto-right">
                            <a class="btn btn-outline-secondary" href="{% url 'forum:update_post' post.pk post.slug %}" role="button">Edit Post</a>
                            <a class="btn btn-outline-danger" href="{% url 'forum:delete_post' post.pk post.slug %}" role="button">Delete Post</a>
                          </div>
                        </div>
                        {% endif %}
                    <!-- </div> -->
                    <!-- <a href="{{post.categories.get_url}}" class="btn btn-secondary btn-sm mb-3 has-icon" data-target=".forum-content"><i class="fa fa-arrow-left mr-2"></i>Back</a> -->
                
                    <div class="card mb-2 bg-dark">
                        <div class="card-body">  
                            <div class="media forum-item">
                                <a href="{% url 'user:profile' post.user.pk post.user%}" class="card-link">
                                    <img src="{{ post.user.profile_pic.url }}" class="rounded-circle" width="50" height="50" alt="User" />
                                    <div class="text-muted small text-center align-self-center py-3">
                                        <span class="d-none d-sm-inline-block text-light" style='color: rgb(172, 172, 172) !important;'>
                                            <i class="fa fa-pencil-square-o text-white" style='color: rgb(172, 172, 172) !important;'></i> 
                                            {% get_hit_count for post %}
                                        </span>
                                        <span class="text-light" style='color: rgb(172, 172, 172) !important;''>
                                            <i class="fa fa-rocket ml-2 text-light" style='color: rgb(172, 172, 172) !important;'></i> 
                                            {{post.user.points}}
                                        </span>
                                    </div>
                                </a>
                                <div class="media-body ml-3">
                                    <a href="{% url 'user:profile' post.user.pk post.user%}" class="text-light" style='color: rgb(204, 204, 204) !important;'>{{post.user}}</a>
                                    <small class="text-light ml-2" style='color: rgb(204, 204, 204) !important;'>{{ post.date|timesince }} ago</small>
                                    <h5 class="mt-1 text-white">{{post.title}}</h5>
                                    <p class="mt-1 text-light">{{post.content}}</p>
                                    <div class="mt-3 font-size-sm">
                                        
                                        
                                        {% if uploads.count != 0 %}
                                        <p><a class="badge badge-secondary" data-bs-toggle="collapse" href="#Coll{{comment.id}}" role="button" aria-expanded="false" aria-controls="collapseExample">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-paperclip" viewBox="0 0 16 16">
                                                <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
                                            </svg>
                                            {{uploads.count}}
                                          </a>
                                        </p>
                                        <div class="collapse" id="Coll{{comment.id}}">
                                            {% for u in extension.docs %}
                                            <!-- <a href="#" class="badge badge-secondary" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="collapseExample"> -->
                                                <a href="{{u.file_upload.url}}" class="badge badge-secondary">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                                                    <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                                                    <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                                                </svg>
                                                {{u.file_upload.name}}
                                              </a>
                                            {% endfor %}
                                            <p></p>
                                            <div id="myCarousel" class="carousel slide" data-ride="carousel" style="background-color: rgb(117, 117, 117);">
                                                <ol class="carousel-indicators">
                                                    {% for u in extension.images %}
                                                        {% if forloop.counter0 == 0 %}
                                                            <li data-target="#myCarousel" class="active"></li>
                                                        {% else %}
                                                            <li data-target="#myCarousel"></li>
                                                        {% endif %}
                                                    {% endfor %}                                               
                                                </ol>
                                                <div class="carousel-inner">
                                                    {% for u in extension.images %}
                                                        {% if forloop.counter == 1 %}
                                                            <div class="carousel-item active">
                                                                <img class="d-block w-100" src="{{u.file_upload.url}}" style="height: 30rem; object-fit: contain;">
                                                            </div>
                                                        {% else %}
                                                            <div class="carousel-item">
                                                                <img class="d-block w-100" src="{{u.file_upload.url}}" style="height: 30rem; object-fit: contain;">
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                                {% if extension.images|length > 1 %}
                                                    <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev" style="background-color: rgb(117, 117, 117);">
                                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                        <span class="sr-only">Previous</span>
                                                    </a>
                                                    <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next" style="background-color: rgb(117, 117, 117);">
                                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                        <span class="sr-only">Next</span>
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% endif %}


                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col-12">
                            <div class="comments">
                                <div class="comments-details">
                                    <span class="total-comments comments-sort" style="color: rgb(179, 179, 179);">Total Comment: {{totl_comment}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!--  Share Comment Section -->
                    <div class="panel">
                        <div class="panel-body">
                          <form action="." method="POST">
                              {% csrf_token %}
                            <textarea name="comment" class="form-control text-light bg-dark" style='border-color:gray; border-width: 1px;' rows="2" placeholder="Type your comment"></textarea>
                            <div class="mar-top clearfix py-2" >
                            <button class="btn btn-sm btn-secondary pull-right" type="submit" value="submit" name="comment-form">
                                Share
                            </button>
                            <!-- <a class="btn btn-trans btn-icon fa fa-camera add-tooltip" href="#"></a>
                            <a class="btn btn-trans btn-icon fa fa-file add-tooltip" href="#"></a> -->
                            </div>
                          </form>
                        </div>
                    </div>
                    <!--  /Share Comment Section -->

                    <!--Comment Area-->
                    {% for comment in post.comments.all %}
                    <div class="card mb-2 bg-dark" >
                        <div class="card-body" style='padding-bottom:0'>
                            <div class="media forum-item">
                                <a href="{% url 'user:profile' comment.user.user_id comment.user%}" class="card-link">
                                    <img src="{{ comment.user.profile_pic.url }}" class="rounded-circle" width="50" height="50" alt="User" />
                                    <div class="text-muted small text-center align-self-center py-3">
                                        <span class="d-none d-sm-inline-block text-light" style='color: rgb(172, 172, 172) !important;'>
                                            <i class="fa fa-pencil-square-o text-light" style='color: rgb(172, 172, 172) !important;'></i>
                                            {{comment.user.num_posts}}
                                        </span>
                                        <span class="text-light" style='color: rgb(172, 172, 172) !important;'>
                                            <i class="fa fa-rocket ml-2 text-light" style='color: rgb(172, 172, 172) !important;'></i>
                                            {{comment.user.points}}
                                        </span>
                                    </div>
                                </a>
                                <div class="media-body ml-3">
                                    <a href="{% url 'user:profile' comment.user.pk comment.user%}" class="text-light" style='color: rgb(204, 204, 204) !important;'>{{comment.user}}</a>
                                    <small class="text-light ml-2" style='color: rgb(204, 204, 204) !important;'>{{ comment.date|timesince }} ago</small>
                                    <div class="mt-3 font-size-sm">
                                        <p class="text-light">{{comment.content}}</p>
                                    </div>
                                    
                                    <!--  Reply ON comment Sections -->
                                    <div class="d-flex justify-content-between">
                                        <div class="p-2" style="padding-left:0 !important;">
                                            <a class="text-light" style='color: rgb(172, 172, 172) !important;' data-bs-toggle="collapse" href="#Coll{{comment.id}}" role="button" aria-expanded="false" aria-controls="collapseExample">
                                                Reply
                                            </a>
                                        </div>
                                        <div class="p-2" style="padding-right:0 !important;">
                                            {% if user.id == comment.user.id %}
                                                <form action="." method="POST">
                                                    {% csrf_token %}
                                                    <button class="btn btn-sm btn-secondary" type="submit" value="{{comment.id}}" name="comment-delete-form">
                                                        <i class="bi bi-trash icon-white"></i>
                                                    </button>
                                                </form>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <!-- <div class="d-inline p-2 bg-dark text-white">d-inline</div>
                                    <p>
                                        <a class="text-light" style='color: rgb(172, 172, 172) !important;' data-bs-toggle="collapse" href="#Coll{{comment.id}}" role="button" aria-expanded="false" aria-controls="collapseExample">
                                            Reply
                                        </a>
                                    </p>
                                        {% if user.id == comment.user.id %}
                                        <form action="." method="POST">
                                            {% csrf_token %}
                                            <button class="btn btn-sm btn-secondary pull-right" type="submit" value="submit" name="comment-delete-form">
                                                <i class="bi bi-trash icon-white"></i>
                                            </button>
                                        </form>
                                        {% endif %} -->
                                    <div class="collapse" id="Coll{{comment.id}}">
                                        <div class="panel">
                                            <div class="panel-body" style='padding-bottom:0'>
                                            <form action="." method="POST">
                                                {% csrf_token %}
                                                <textarea name="reply" class="form-control bg-dark text-light" style='border-color:gray; border-width: 1px;' rows="2" placeholder="Type your reply"></textarea>
                                                <div class="mar-top clearfix py-2" >
                                                <button class="btn btn-sm btn-secondary pull-right" type="submit" value="submit" name="reply-form">
                                                    Reply
                                                </button>
                                                <input type="hidden" name="comment-id" value="{{ comment.id }}">
                                                </div>
                                            </form>
                                            </div>
                                        </div>
                                    </div>
                                    <!--  /Reply  ON comment Sections -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /Comment Area -->

                    <!-- Reply Area -->           
                    {% for reply in comment.replies.all %}
                    <div class="card mb-2 bg-dark text-light" style="width: 95%; margin-left:5%;">
                        <div class="card-body" style='padding-bottom:10px'>
                            <div class="media forum-item">
                                <a href="{% url 'user:profile' reply.user.user_id reply.user%}" class="card-link">
                                    <img src="{{ post.user.profile_pic.url }}" class="rounded-circle" width="50" height="50" alt="User" />
                                    <div class="text-muted small text-center align-self-center py-3">
                                        <span class="d-none d-sm-inline-block" style='color: rgb(172, 172, 172) !important;'>
                                            <i class="fa fa-pencil-square-o" style='color: rgb(172, 172, 172) !important;'></i>
                                            {{reply.user.num_posts}}
                                        </span>
                                        <span style='color: rgb(172, 172, 172) !important;'>
                                            <i class="fa fa-rocket ml-2" style='color: rgb(172, 172, 172) !important;'></i> 
                                            {{reply.user.points}}
                                        </span>
                                    </div>
                                </a>
                                <div class="media-body ml-3">
                                    <a href="{% url 'user:profile' reply.user.pk reply.user%}" class="text-light" style='color: rgb(204, 204, 204) !important;'>{{reply.user}}</a>
                                    <small class="text-light ml-2" style='color: rgb(204, 204, 204) !important;'>{{ reply.date|timesince }} ago</small>
                                    <div class="mt-3 font-size-sm">
                                        <p>{{reply.content}}</p>
                                    </div>
                                    <p>
                                        {% if user.id == reply.user.id %}
                                        <form action="." method="POST">
                                            {% csrf_token %}
                                            <button class="btn btn-sm btn-secondary pull-right" type="submit" value="{{ reply.id }}" name="reply-delete-form">
                                                <i class="bi bi-trash icon-white"></i>
                                            </button>
                                        </form>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% endfor %}
                    <!-- /Reply Area -->           



                    <!-- pagination -->
                </div>
                <!-- /Forum Detail -->
            </div>
            <!-- /Inner main -->
        </div>
        <!-- /Inner wrapper -->
    
    </div>
</div>
<!-- Footer -->
{% include 'components/footer.html' %}
<!-- Footer -->
{% endblock content %}	